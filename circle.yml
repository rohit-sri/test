---
machine:
   php:
   version: 5.6.30
   mysql:
   vesrion: 5.5.47
   apache2:
   version: 22.4.7
dependencies:
   pre:
      - sudo apt-add-repository -y ppa:ondrej/php
      - sudo apt-get -y update
      - sudo apt-get -y install php5.6
      - sudo apt-get -y install mysql-server
      - sudo apt-get install apache2
   post:
      - sudo service apache2 restart
      - sudo service mysql restart
dependencies:
   post:
      - docker built -t $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/amazon:latest :$CIRCLE_SHA1
test:
   post:
      - docker run -d -p 8080:8080 --name awmazon $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/amazon:latest :$CIRCLE_SHA1; sleep 10
      - curl --retry 10 --retry-delay 5 localhost:8080 | grep "hello world"
