---
machine:
      service:
         - docker
dependencies:
   pre:
      - sudo apt-get -y update
      - sudo apt-get -y install docker
   post:
      - sudo service docker start
      - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/test:$CIRCLE_SHA1
test:
      post:
         - docker run -d -p 8080:8080 --name test $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/test:$CIRCLE_SHA1 sleep 10
         - curl --retry 10 --retry-delay 5 localhost:8080 | grep "Hello World!"
